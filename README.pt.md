[![Test](https://github.com/raul-macedo-freire/currency-challenge-bravo-api/actions/workflows/Tests.yml/badge.svg)](https://github.com/raul-macedo-freire/currency-challenge-bravo-api/actions/workflows/Tests.yml)

[![Python 3.10.6](https://img.shields.io/badge/python-3.10.6-blue.svg)](https://www.python.org/downloads/release/python-3106/)

<p align="center">
  <img src="https://gifs.eco.br/wp-content/uploads/2021/09/imagens-e-gifs-do-tio-patinhas-5.gif" alt="!LET'S MAKE SOME MONEY LAD/LASS!(read with scottish accent)"/>
</p>

# ü¶Ü üí≤**SCROOGE MCDUCK CURRENCY FLASK API- CURRENCY CHALLENGE BRAVO**üí≤ ü¶Ü

</br>

ScroogeMcDuckCurrencyApi √© um aplicativo de suporte a v√°rias moedas, que permite ao usu√°rio:

-   Converter valores de uma moeda para outras
-   Cria sua pr√≥pria moeda com base na taxa de c√¢mbio do d√≥lar
-   Execute m√©todos RestFull b√°sicos, como: Localizar, atualizar e excluir.

Esta API foi constru√≠da com[APP Flask](https://flask.palletsprojects.com/en/2.2.x/)e[Flask-restx](https://flask-restx.readthedocs.io/en/latest/), portanto pode ser utilizado integrado com[Swagger.ui](https://swagger.io/tools/swagger-ui/)interface.

## üìñ**Idiomas dispon√≠veis do Documentos:**

-   [Ingl√™s](README.md)
-   [Portugu√™s](README.pt.md)
-   [Espanhol](README.es.md)

## üë∑**Servi√ßo de terceiros - OpenExchangeAPI**

</br>

Uma vez que as taxas de c√¢mbio est√£o constantemente sendo atualizadas, n√£o √© poss√≠vel para um ser humano continuar atualizando todos os dados de moedas, a fim de converter valores dinamicamente. Por esse motivo, ScroogeMcDuckCurrencyApi √© integrado com[API do OpenExchange](https://openexchangerates.org/)servi√ßo gratuito de moeda Api.</br>No entanto, uma vez que o usu√°rio verifica uma moeda ou quaisquer m√©todos, ScroogeMcDuckCurrencyApi n√£o consultar√° diretamente o OpenExchange, mas seu pr√≥prio banco de dados. Os dados provenientes do OpenExchange s√£o atualizados dinamicamente de acordo com a configura√ß√£o de agendamento do sistema, a ser explicado em[configura√ß√£o](#api-configuration)se√ß√£o.

## üíµ**Taxa de convers√£o do d√≥lar**

A API de moeda do Tio Patinhas funciona com base na taxa de convers√£o do d√≥lar, portanto, cada moeda deve ser convertida de seu valor para d√≥lar, antes de ser convertida em outra moeda.

Vamos fazer um exemplo:

Se voc√™ quiser converter a moeda do pr√≥prio Tio Patinhas para BRL (moeda brasileira), voc√™ deve ter a taxa de convers√£o da moeda do McDuck's d√≥lar, ou seja, quantas moedas do McDuck voc√™ precisa para transform√°-la em um doller.

Digamos que a taxa de convers√£o do d√≥lar do McDuck seja 2 (o que n√£o √© poss√≠vel, pois ele √© muito rico), ent√£o voc√™ precisa de 2 moedas do McDuck para fazer um d√≥lar. Hoje em dia (e isso √© impressionantemente assustador), a taxa de convers√£o do d√≥lar de BRL para USD (identificador universal do d√≥lar) √© de 5,22. Para converter 5 McDuck's em Reais, fazemos:

(5/2)\*5.22 = 13.05 Reais

<p align="center">
  <img src="https://images.gr-assets.com/hostedimages/1576518017ra/28622252.gif" alt="Math is fantastic!"/>
</p>

## üíâ**Inje√ß√£o de depend√™ncia**

Para usar conceitos e ferramentas de inje√ß√£o de depend√™ncia, esta API usa python[injetor](https://injector.readthedocs.io/en/latest/). Eu tive que encontrar algumas l√≥gicas para faz√™-lo funcionar bem, o que funcionou,~~Na minha humilde opini√£o~~, muito bem e parece muito bem.

## ‚åö**Agendador**

ScroogeMcDuckCurrencyApi executa opera√ß√µes cronol√≥gicas para atualizar o banco de dados com a API OpenExchange.</br>Apesar do fato de que o python possui muitas bibliotecas para agendamento e enfileiramento, como:[schedule](https://github.com/dbader/schedule),[cronista](https://github.com/kiorky/croniter)ou[flask-cronjob](https://pypi.org/project/flask-crontab/), este servi√ßo n√£o utiliza tais ferramentas, pretendendo buscar uma abordagem mais enxuta.

## üìî**Armazenamento de dados**

</br>

ScroogeMcDuckCurrencyApi tem um[mongoDb](https://www.mongodb.com/en-us)banco de dados para armazenar dados do OpenExchange e inseridos pelos usu√°rios.</br>O uso do mongo facilita o uso do fant√°stico[outro motor](https://docs.mongoengine.org/tutorial.html)pacote ORM python, pois fornece uma vis√£o muito melhor do c√≥digo com modelos de objeto.

## ‚ùó‚ùó**Isen√ß√£o de responsabilidade**

</br>
ScroogeMcDuckCurrencyApi has a pretty nice interface and performs just fine given it's objective, however it does not perform automatic updates for  currencies that are not provided by OpenExchange API, in that way, in order to update custom currencies, the user must keep it up to date manually or create a provider to perform updates on the API from its source. 

</br>
</br>

O c√≥digo-fonte ScroogeMcDuckCurrencyApi tem alguns coment√°rios que valem a pena procurar, que voc√™ pode verificar, procurando por`NOTES:`

## ‚öôÔ∏è**Configura√ß√£o da API**

</br>

Apesar de esta aplica√ß√£o utilizar apenas recursos gratuitos, a vida nem sempre √© um mar de rosas, temos alguns segredos a esconder üïµÔ∏è e algumas configura√ß√µes a fazer.
Na verdade, s√≥ temos um segredo, a ser explicado a seguir.</br>

#### <u>ID do aplicativo OpenExchange</u>

</br>

O OpenExchange fornece uma API de uso gratuito, mas, para usar essa API, voc√™ deve ter uma conta no open exchange. Por isso:

-   V√° para[P√°gina de login do OpenExchange](https://openexchangerates.org/signup/free)
-   crie sua conta
-   Verifique o seu APP ID em[p√°gina de IDs de APP](https://openexchangerates.org/account/app-ids)
-   Substitua o campo`{YOUR_OPENEXCHANGE_APP_ID_COMES_HERE}`no[arquivo docker-compose](docker-compose.yml)

    **Obs:**Se voc√™ pretende executar este aplicativo usando um IDE, basta salvar o ID do aplicativo Open Exchange como uma vari√°vel de ambiente com o nome`OPENEXCHANGE_APP_ID`.

#### <u>Agendador de atualiza√ß√£o do banco de dados</u>

</br>

Por padr√£o, a API atualiza o banco de dados com a API openExchange a cada 10 minutos, mas se voc√™ quiser aumentar ou diminuir (quem sabe?) esse atraso, basta substituir o valor de`UPDATE_CURRENCIES_MINUTES_SCHEDULE`no[arquivo docker-compose](docker-compose.yml)

**Obs:**Assim como o[se√ß√£o anterior](#uopenexchange-app-idu), se voc√™ estiver executando a API localmente em seu IDE, atualize a vari√°vel de ambiente`UPDATE_CURRENCIES_MINUTES_SCHEDULE`.

## üèÉ**Executando o aplicativo**

Primeiro de tudo, clone o reposit√≥rio:

    git clone git@github.com:raul-macedo-freire/currency-challenge-bravo-api.git

Para executar a API, voc√™ tem duas op√ß√µes:

-   Executar com docker-compose
-   Executar com um IDE

#### <b>Executar com docker-compose</b>

Se voc√™ n√£o est√° acostumado a trabalhar com docker, d√™ uma olhada no[documentos](https://docs.docker.com/get-started/overview/)e instalar[docker-compose](https://docs.docker.com/compose/).

Depois de se acostumar com o docker, configure o arquivo docker-compose, de acordo com o[Se√ß√£o de configura√ß√£o da API](#api-configuration)

Na pasta do projeto, execute:

```bash
docker compose up
```

Verifique a interface do aplicativo em: https&#x3A;//localhost:5000/swagger

### <b>Executar com um IDE</b>

Salve as vari√°veis ‚Äã‚Äãde ambiente de acordo com o[Observa√ß√µes de configura√ß√£o da API](#api-configuration).

Se voc√™ n√£o estiver usando um gerenciador de depend√™ncias, recomendo usar algo como[pytest](https://docs.pytest.org/en/latest/getting-started.html#install-pytest).

Se voc√™ n√£o quiser usar o pyenv e instalar depend√™ncias no ambiente python global (quem sabe?), pule para[Instalando Depend√™ncias](#uinstalling-dependenciesu)se√ß√£o.

#### <u>Configura√ß√£o do ambiente Python:</u>

Este projeto usa python 3.10.6, vou considerar que voc√™ est√° usando pyenv para gerenciamento de vers√£o python, caso n√£o esteja, verifique a configura√ß√£o do gerenciador de depend√™ncias e siga os passos abaixo de forma equivalente.

Verifique a vers√£o do python:

```bash
python --version
```

Caso n√£o esteja utilizando a vers√£o 3.10.6, verifique se a possui instalada, com:

```bash
pyenv versions
```

Caso contr√°rio, instale a vers√£o com:

```bash
pyenv install -v 3.10.6
```

Em seguida, defina a vers√£o localmente:

```bash
pyenv local 3.10.6
```

No diret√≥rio raiz da API, crie um novo ambiente python:

```bash
python -m venv <virtual-env-name>
```

Ative o ambiente virtual

```bash
source <virtual-env-name>/bin/activate
```

se estiver usando windows acesse o ambiente virtual com:

```bash
 .\venv\Scripts\activate
```

#### <u>Instalando Depend√™ncias:</u>

    pip install -r requirements.txt

### <u>Executando o aplicativo:</u>

Se voc√™ estiver usando[VSCODE](https://code.visualstudio.com/), j√° forneci um script de execu√ß√£o com um[lan√ßar arquivo](./.vscode/launch.json), ent√£o se for o caso:

-   Salve as vari√°veis ‚Äã‚Äãde ambiente em um`.env`arquivo
-   Execute o`run application`script com atalho F5.

Se voc√™ n√£o estiver usando o VSCODE,~~comece a usar~~, d√™ uma olhada na configura√ß√£o do seu IDE e execute o aplicativo a partir do`run.py`root e n√£o se esque√ßa de salvar as vari√°veis ‚Äã‚Äãde ambiente em configuration.

Verifique a interface do aplicativo em: https&#x3A;//localhost:5000/swagger

**!!!OBSERVA√á√ÉO!!!:**Se voc√™ executar o aplicativo dessa forma, n√£o poder√° executar solicita√ß√µes de API, pois o banco de dados n√£o estar√° em execu√ß√£o.

## üß™<b>Testes de execu√ß√£o</b>

### <u>testes de unidade</u>

Para executar todos os testes de unidade, use:

```bash
python -m pytest
```

### <u>Testes de estresse</u>

Este aplicativo usa a ferramenta k6.io para realizar testes de estresse.
Verifica a[documenta√ß√£o do k6](https://k6.io/docs/getting-started/installation/)para instalar a ferramenta.

Para executar o teste, na raiz do aplicativo, entre na pasta de testes:

```bash
cd ./tests
```

E fa√ßa o teste:

```bash
k6 run sovietic_attack.js 
```

**Obs1:**N√£o se esque√ßa de ter o aplicativo instalado e funcionando antes de executar o teste

**Obs2:**Para tornar os testes mais precisos para a API, cada endpoint deve ser testado individualmente, seguindo as[considera√ß√µes](https://k6.io/blog/how-to-generate-a-constant-request-rate-with-the-new-scenarios-api/), se voc√™ quiser testar cada endpoint, descomente o endpoint e comente o resto (ou n√£o, ningu√©m manda em voc√™`¬Ø\_(„ÉÑ)_/¬Ø`).

</br>

## üòé**Considera√ß√µes Finais**

Se voc√™ √© muito ruim com exemplos e n√£o sabe como come√ßar a experimentar a API, d√™ uma olhada em[carteiro_exemplos](postman_examples/ScroogeMcDuckCurrencyApi.postman_collection.json). Se voc√™ n√£o conhece o carteiro, eu recomendo fortemente que voc√™[De uma chance](https://www.postman.com/):D

# Documenta√ß√£o resumida:

-   [penv](http://blog.abraseucodigo.com.br/instalando-qualquer-versao-do-python-no-linux-macosx-utilizando-pyenv.html)
-   [Pytest](https://docs.pytest.org/en/latest/getting-started.html#install-pytest)
-   [Frasco](https://flask.palletsprojects.com/en/2.2.x/)
-   [Flask-Restx](https://flask-restx.readthedocs.io/en/latest/)
-   [outro motor](https://docs.mongoengine.org/tutorial.html)
-   [API do OpenExchange](https://openexchangerates.org/)
-   [Docker-Compose](docker-compose.yml)
-   [ksh](https://k6.io/docs/)

# 

## Estrutura do Projeto

```
currency-challenge-bravo-api
‚îú‚îÄ .github
‚îÇ  ‚îî‚îÄ workflows
‚îÇ     ‚îú‚îÄ readme.yml
‚îÇ     ‚îî‚îÄ Tests.yml
‚îú‚îÄ .gitignore
‚îú‚îÄ .vscode
‚îÇ  ‚îú‚îÄ launch.json
‚îÇ  ‚îî‚îÄ settings.json
‚îú‚îÄ app
‚îÇ  ‚îú‚îÄ api.py
‚îÇ  ‚îú‚îÄ config
‚îÇ  ‚îÇ  ‚îú‚îÄ config.ini
‚îÇ  ‚îÇ  ‚îî‚îÄ config_helper.py
‚îÇ  ‚îú‚îÄ controllers
‚îÇ  ‚îÇ  ‚îú‚îÄ base_controller.py
‚îÇ  ‚îÇ  ‚îú‚îÄ currencies_controller.py
‚îÇ  ‚îÇ  ‚îú‚îÄ currency_controller.py
‚îÇ  ‚îÇ  ‚îú‚îÄ currency_converter_controller.py
‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ core
‚îÇ  ‚îÇ  ‚îú‚îÄ entities
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ currency.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îú‚îÄ exceptions
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ base_exceptions.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ client_errors
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ currency_not_found.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ parameters_missing_error.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ validation_error.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ server_errors
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ configuration_error.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ external_service_error.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ infra_service_unauthorized.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ infra
‚îÇ  ‚îÇ  ‚îú‚îÄ models
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ currency_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îú‚îÄ repositories
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ currency_repository.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ interfaces
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ abstract_currency_repository.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îú‚îÄ services
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ interfaces
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ abstract_external_currency_service.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ open_exchanges_api_service.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ ioc.py
‚îÇ  ‚îú‚îÄ middleware
‚îÇ  ‚îÇ  ‚îú‚îÄ exception_middleware.py
‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ models
‚îÇ  ‚îÇ  ‚îú‚îÄ input_model
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ base_input_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ currency_converter_query_parameters_input_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ currency_input_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ update_currency_input_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îú‚îÄ view_model
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ base_view_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ get_currencies_view_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ get_currency_view_model.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ scheduler.py
‚îÇ  ‚îú‚îÄ services
‚îÇ  ‚îÇ  ‚îú‚îÄ converter_service.py
‚îÇ  ‚îÇ  ‚îú‚îÄ currency_service.py
‚îÇ  ‚îÇ  ‚îú‚îÄ interfaces
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ abstract_converter_service.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ abstract_currency_service.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
‚îÇ  ‚îú‚îÄ update_db_worker.py
‚îÇ  ‚îî‚îÄ __init__.py
‚îú‚îÄ docker-compose.yml
‚îú‚îÄ Dockerfile
‚îú‚îÄ LICENSE
‚îú‚îÄ mongo-init.js
‚îú‚îÄ README.es.md
‚îú‚îÄ README.md
‚îú‚îÄ README.pt.md
‚îú‚îÄ requirements.txt
‚îú‚îÄ run.py
‚îî‚îÄ tests
   ‚îú‚îÄ app
   ‚îÇ  ‚îú‚îÄ core
   ‚îÇ  ‚îÇ  ‚îú‚îÄ entities
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ test_currency.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îÇ  ‚îú‚îÄ infra
   ‚îÇ  ‚îÇ  ‚îú‚îÄ repositories
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ test_currency_repository.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ services
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ test_open_exchanges_api_service.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îÇ  ‚îú‚îÄ services
   ‚îÇ  ‚îÇ  ‚îú‚îÄ test_converter_service.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ test_currency_service.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ __ini__.py
   ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îú‚îÄ sovietic_attack.js
   ‚îú‚îÄ tests_helper
   ‚îÇ  ‚îú‚îÄ factory
   ‚îÇ  ‚îÇ  ‚îú‚îÄ factory.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îÇ  ‚îú‚îÄ requests_mock.py
   ‚îÇ  ‚îî‚îÄ __init__.py
   ‚îî‚îÄ __init__.py

```
